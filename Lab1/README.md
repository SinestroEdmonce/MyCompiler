# 程序功能

- [x] 代码中**已实现**了对C语言代码的词法分析、语法分析并且进行错误提示以及无错输出语法树结构等功能。  
- [x] 代码中**已实现**的词法分析部分采用了``GNU Flex``方法，语法分析部分采用了``GNU Bison``方法并且自行设计了多叉树结构。

---

## 数据结构

1. 为了实现语法树，实验中设计了多叉树结构，所谓多叉树就是将左子树作为孩子分支，而将右子树作为兄弟分支，换言之就是左子树是下层而右子树则是同层结点。

2. 具体的数据结构设计如下：

```cpp
    typedef struct Node {
        // Node type
        char type[32]; 
        // Node value
        char value[64]
        int linenum;
        // Its children and its brothers
        struct Node* child;
        struct Node* sibling;
        bool is_non_ternmial;
    } TreeNode;
```

3. 结构体中``linenum``用于存储结点所在的行号；``is_non_ternmial``标明结点是否是终结符号。

## 实现思路

- 首先是对代码文件进行词法分析，这一部分重点在于设计合法合理的正则表达式。``GNU Flex``会使用给定的正则表达式进行最长匹配，最终将代码文件分割成词法单元。

- 其次是对给定的词法单元进行语法分析，报告错误或者生成语法树，这一部分重点在于设计存储语法树的多叉树结构。一个好的数据结构会大大减小语法分析任务的代码负担。除此之外，根据给定的C语言语法构建``GNU Bison``的产生式和语义规则也需要细致处理。

- 最后是在合适的位置填入``error``符号，帮助``GNU Bison``检查语法错误并进行指定的错误恢复。填入``error``符号的位置一般在分号、中括号等一些容易发生语法错误的符号前后，不过不仅仅是这些。

## 实验难点

- 多叉树数据结构设计
- 正则表达式设计
- ``error``符号填入位置

## 解决方案

详见**Lab1**代码部分。  
( **Note**：对于``int``、``float``数值和C风格注释的正则表达式设计需要细致 )

## 编译及运行方法

首先压缩包解压后得到的文件夹``Lab1``,``Test``文件夹中存储了10个测试用例，``Code``文件夹存储了所有代码文件，``results.txt``文件存储了10个测试用例的测试结果（包括错误提示的输出和无错语法树的输出）。

- 如果想要直接编译运行，则在shell命令行执行``./run.sh``，则会直接编译并且对``Test``文件夹下的用例进行测试，输出的结果按序存储在``results.txt``中。

- 如果仅仅想要编译，则进入``Code``文件夹执行``make parser``，则会重新编译并在上层目录``Lab1``得到可执行文件``parser``。

- 如果想要对某一个测试用例进行测试，则在``Lab1``目录下执行``./parser xxx``,其中``xxx``代表将要被测试的用例。
